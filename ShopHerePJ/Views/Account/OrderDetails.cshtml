@model ShopHerePJ.Data.Entities.order
@{
    ViewData["Title"] = "Order Details";
    Layout = "~/Views/Shared/_StoreLayout.cshtml";

    string Badge(string s)
    {
        s = (s ?? "").Trim().ToLower();
        return s switch
        {
            "pending_payment" => "badge-warn",
            "processing" => "badge-info",
            "shipped" => "badge-info",
            "completed" => "badge-ok",
            "cancelled" => "badge-bad",
            "refunded" => "badge-bad",
            "paid" => "badge-ok",
            _ => "badge-plain"
        };
    }
}

<style>
    .od-wrap {
        padding: 28px 0;
    }

    .od-hero {
        border-radius: 22px;
        background: linear-gradient(135deg,#0f172a,#1f2937);
        color: #fff;
        border: 1px solid rgba(255,255,255,.14);
        padding: 18px 18px;
        box-shadow: 0 12px 30px rgba(0,0,0,.10);
    }

        .od-hero h1 {
            font-size: 18px;
            font-weight: 900;
            margin: 0;
        }

        .od-hero .sub {
            opacity: .82;
            font-size: 13px;
            margin-top: 3px;
        }

        .od-hero .btn {
            border-radius: 999px;
            font-weight: 800;
        }

    .od-card {
        background: #fff;
        border: 1px solid rgba(0,0,0,.08);
        border-radius: 20px;
        box-shadow: 0 10px 26px rgba(0,0,0,.06);
        overflow: hidden;
    }

        .od-card .hd {
            padding: 14px 16px;
            background: #f8fafc;
            border-bottom: 1px solid rgba(0,0,0,.06);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
        }

            .od-card .hd .t {
                font-weight: 900;
            }

        .od-card .bd {
            padding: 14px 16px;
        }

    .badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 6px 10px;
        border-radius: 999px;
        font-size: 12px;
        font-weight: 800;
        border: 1px solid rgba(0,0,0,.10);
        background: #f8fafc;
        color: #0f172a;
        white-space: nowrap;
    }

    .badge-ok {
        background: #ecfdf5;
        border-color: #a7f3d0;
        color: #065f46;
    }

    .badge-warn {
        background: #fffbeb;
        border-color: #fde68a;
        color: #92400e;
    }

    .badge-info {
        background: #ecfeff;
        border-color: #a5f3fc;
        color: #155e75;
    }

    .badge-bad {
        background: #fef2f2;
        border-color: #fecaca;
        color: #991b1b;
    }

    .badge-plain {
        background: #f3f4f6;
        border-color: #e5e7eb;
        color: #111827;
    }

    .od-grid {
        display: grid;
        grid-template-columns: 1fr 360px;
        gap: 14px;
    }

    .kvs {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
    }

    .kv {
        border: 1px solid rgba(0,0,0,.08);
        border-radius: 16px;
        padding: 12px 12px;
        background: #fff;
    }

        .kv .k {
            color: #6b7280;
            font-size: 12px;
            margin-bottom: 4px;
        }

        .kv .v {
            font-weight: 900;
            color: #111827;
            word-break: break-word;
        }

    .totals .rowx {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 10px 0;
        border-top: 1px dashed rgba(0,0,0,.16);
    }

        .totals .rowx:first-child {
            border-top: 0;
        }

    .totals .k {
        color: #6b7280;
        font-size: 13px;
    }

    .totals .v {
        font-weight: 900;
    }

    .totals .grand {
        font-size: 18px;
    }

    .od-table thead th {
        font-size: 12px;
        letter-spacing: .06em;
        text-transform: uppercase;
        color: #6b7280;
    }

    .od-table td, .od-table th {
        padding: 12px 14px;
    }

    .od-item {
        display: flex;
        gap: 12px;
        align-items: center;
        min-width: 0;
    }

    .thumb {
        width: 44px;
        height: 44px;
        border-radius: 14px;
        border: 1px solid rgba(0,0,0,.10);
        background: #f6f7f8;
        display: flex;
        align-items: center;
        justify-content: center;
        flex: 0 0 auto;
        font-weight: 900;
        color: #111827;
    }

    .iname {
        font-weight: 900;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .ivari {
        color: #6b7280;
        font-size: 12px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .money {
        font-variant-numeric: tabular-nums;
    }
</style>

<div class="container od-wrap">
    <!-- HERO -->
    <div class="od-hero mb-3">
        <div class="d-flex justify-content-between align-items-start flex-wrap gap-2">
            <div>
                <h1>Order #@Model.order_number</h1>
                <div class="sub">Created: @Model.created_at.ToString("dd/MM/yyyy HH:mm")</div>
            </div>

            <div class="d-flex gap-2 align-items-center">
                <span class="badge @Badge(Model.status)">Status: @Model.status</span>
                <span class="badge @Badge(Model.payment_status)">Payment: @Model.payment_status</span>
                <a class="btn btn-outline-light btn-sm" asp-controller="Account" asp-action="Orders">Back</a>
            </div>
        </div>
    </div>

    <div class="od-grid">
        <!-- LEFT: Items -->
        <div class="od-card">
            <div class="hd">
                <div class="t">Items</div>
                <div class="text-muted small">(@(Model.order_items?.Count ?? 0) items)</div>
            </div>

            <div class="table-responsive">
                <table class="table od-table align-middle mb-0">
                    <thead class="table-light">
                        <tr>
                            <th>Item</th>
                            <th>SKU</th>
                            <th class="text-end">Price</th>
                            <th class="text-end">Qty</th>
                            <th class="text-end">Total</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var it in Model.order_items)
                        {
                            <tr>
                                <td style="max-width:420px;">
                                    <div class="od-item">
                                        <div class="thumb">🛍</div>
                                        <div class="min-w-0" style="min-width:0;">
                                            <div class="iname">@it.product_name_snapshot</div>
                                            <div class="ivari">@it.variant_name_snapshot</div>
                                        </div>
                                    </div>
                                </td>
                                <td class="text-muted">@it.sku_snapshot</td>
                                <td class="text-end money">@it.unit_price.ToString("N0")</td>
                                <td class="text-end">@it.quantity</td>
                                <td class="text-end fw-bold money">@it.line_total.ToString("N0")</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>

        <!-- RIGHT: Summary -->
        <div class="d-flex flex-column gap-3">
            <div class="od-card">
                <div class="hd">
                    <div class="t">Order summary</div>
                </div>
                <div class="bd">
                    <div class="kvs">
                        <div class="kv">
                            <div class="k">Shipping method</div>
                            <div class="v">@(!string.IsNullOrWhiteSpace(Model.shipping_method) ? Model.shipping_method : "—")</div>
                        </div>
                        <div class="kv">
                            <div class="k">Tracking</div>
                            <div class="v">@(!string.IsNullOrWhiteSpace(Model.tracking_number) ? Model.tracking_number : "—")</div>
                        </div>
                        <div class="kv">
                            <div class="k">Payment method</div>
                            <div class="v">@(!string.IsNullOrWhiteSpace(Model.payment_method) ? Model.payment_method : "—")</div>
                        </div>
                        <div class="kv">
                            <div class="k">Currency</div>
                            <div class="v">@Model.currency</div>
                        </div>
                    </div>

                    @if (!string.IsNullOrWhiteSpace(Model.customer_note))
                    {
                        <div class="kv mt-2">
                            <div class="k">Customer note</div>
                            <div class="v" style="font-weight:700">@Model.customer_note</div>
                        </div>
                    }
                </div>
            </div>

            <div class="od-card totals">
                <div class="hd">
                    <div class="t">Totals</div>
                </div>
                <div class="bd">
                    <div class="rowx">
                        <div class="k">Subtotal</div>
                        <div class="v money">@Model.subtotal_amount.ToString("N0")</div>
                    </div>
                    <div class="rowx">
                        <div class="k">Discount</div>
                        <div class="v money">@Model.discount_amount.ToString("N0")</div>
                    </div>
                    <div class="rowx">
                        <div class="k">Shipping</div>
                        <div class="v money">@Model.shipping_fee.ToString("N0")</div>
                    </div>
                    <div class="rowx">
                        <div class="k">Tax</div>
                        <div class="v money">@Model.tax_amount.ToString("N0")</div>
                    </div>
                    <div class="rowx">
                        <div class="k fw-bold">Grand total</div>
                        <div class="v grand money">@Model.grand_total.ToString("N0") @Model.currency</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
